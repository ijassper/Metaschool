{% extends 'base.html' %}

{% block content %}
<div class="container-fluid mt-3 mb-5 px-4"> <!-- 꽉 찬 화면을 위해 container-fluid 사용 -->
    
    <div class="row">
        <!-- ★ 왼쪽: 문제지 (Read Only) -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100 shadow-sm border-secondary">
                <div class="card-header bg-secondary text-white fw-bold">
                    <i class="bi bi-file-text"></i> 평가 문제지
                </div>
                <div class="card-body bg-light">
                    
                    <!-- 1. 기본 정보 (스케치 상단) -->
                    <div class="mb-3">
                        <label class="fw-bold text-secondary small">평가 일시</label>
                        <input type="text" class="form-control bg-white" value="{{ today|date:'Y년 m월 d일' }}" readonly>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="fw-bold text-secondary small">과목명</label>
                            <input type="text" class="form-control bg-white" value="{{ activity.subject_name }}" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="fw-bold text-secondary small">평가영역명</label>
                            <input type="text" class="form-control bg-white" value="{{ activity.section }}" readonly>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="fw-bold text-secondary small">평가 주제</label>
                        <input type="text" class="form-control bg-white fw-bold" value="{{ activity.title }}" readonly>
                    </div>

                    <hr>

                    <!-- 2. 문항 내용 -->
                    <div class="mb-3">
                        <label class="fw-bold text-dark"><i class="bi bi-question-circle-fill"></i> 평가 문항</label>
                        <div class="p-3 bg-white border rounded" style="min-height: 150px; white-space: pre-wrap;">{{ question.content }}</div>
                    </div>

                    <!-- 3. 참고 자료 -->
                    {% if question.reference %}
                    <div class="mb-3">
                        <label class="fw-bold text-dark"><i class="bi bi-journal-text"></i> 참고 자료</label>
                        <div class="p-3 bg-white border rounded text-muted small" style="min-height: 100px; white-space: pre-wrap;">{{ question.reference }}</div>
                    </div>
                    {% endif %}

                    <!-- 4. 작성 조건 -->
                    <div class="mb-3">
                        <label class="fw-bold text-dark"><i class="bi bi-exclamation-circle"></i> 작성 조건</label>
                        <div class="alert alert-warning mb-0 small">
                            {{ question.conditions|default:"특별한 조건이 없습니다." }}
                            {% if question.max_length %}
                                <br><strong>(분량 제한: {{ question.max_length }}자 이내)</strong>
                            {% endif %}
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- ★ 오른쪽: 답안지 (Write) -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100 shadow border-primary">
                <div class="card-header bg-primary text-white fw-bold">
                    <i class="bi bi-pencil-square"></i> 답안 작성 ({{ user.name }} 학생)
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="d-flex justify-content-between mb-2">
                            <label class="form-label fw-bold">답안 내용</label>
                            <span id="charCount" class="badge bg-secondary">0자 / {{ question.max_length|default:'무제한' }}</span>
                        </div>

                        <!-- 답안 입력창 -->
                        {{ form.content }}
                        
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg fw-bold p-3" onclick="return confirm('답안을 제출하시겠습니까?');">
                                <i class="bi bi-send-fill"></i> 답안 제출하기
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 글자 수 세기 스크립트 -->
<script>
    const textarea = document.getElementById('id_content');
    const counter = document.getElementById('charCount');
    const limit = {{ question.max_length|default:0 }};

    textarea.addEventListener('input', function() {
        const currentLength = this.value.length;
        if (limit > 0) {
            counter.innerText = `${currentLength}자 / ${limit}자`;
            if (currentLength > limit) {
                counter.classList.replace('bg-secondary', 'bg-danger');
            } else {
                counter.classList.replace('bg-danger', 'bg-secondary');
            }
        } else {
            counter.innerText = `${currentLength}자`;
        }
    });
</script>
{% endblock %}